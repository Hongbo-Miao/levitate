var e=require("./index.production.js"),n=require("react"),r=require("@grafana/data");require("react-inlinesvg"),require("react-dom");var t=require("@grafana/e2e-selectors");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("crypto"),require("moment"),require("tty"),require("util"),require("os"),require("@grafana/schema"),require("jquery"),require("@grafana/aws-sdk");var i=o(n);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function u(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function s(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?u(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function l(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function p(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function d(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?p(Object(r),!0).forEach((function(n){l(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function f(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(e){return n.reduceRight((function(e,n){return n(e)}),e)}}function g(e){return function n(){for(var r=this,t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return o.length>=e.length?e.apply(this,o):function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.apply(r,[].concat(o,t))}}}function h(e){return{}.toString.call(e).includes("Object")}function m(e){return"function"==typeof e}var y=g((function(e,n){throw new Error(e[n]||e.default)}))({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),v={changes:function(e,n){return h(n)||y("changeType"),Object.keys(n).some((function(n){return r=e,t=n,!Object.prototype.hasOwnProperty.call(r,t);var r,t}))&&y("changeField"),n},selector:function(e){m(e)||y("selectorType")},handler:function(e){m(e)||h(e)||y("handlerType"),h(e)&&Object.values(e).some((function(e){return!m(e)}))&&y("handlersType")},initial:function(e){var n;e||y("initialIsRequired"),h(e)||y("initialType"),n=e,Object.keys(n).length||y("initialContent")}};function b(e,n){return m(n)?n(e.current):n}function T(e,n){return e.current=d(d({},e.current),n),n}function w(e,n,r){return m(n)?n(e.current):Object.keys(r).forEach((function(r){var t;return null===(t=n[r])||void 0===t?void 0:t.call(n,e.current[r])})),r}var M={create:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v.initial(e),v.handler(n);var r={current:e},t=g(w)(r,n),o=g(T)(r),i=g(v.changes)(e),a=g(b)(r);function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return v.selector(e),e(r.current)}function s(e){f(t,o,i,a)(e)}return[u,s]}};var O,C={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},j=(O=function(e,n){throw new Error(e[n]||e.default)},function e(){for(var n=this,r=arguments.length,t=new Array(r),o=0;o<r;o++)t[o]=arguments[o];return t.length>=O.length?O.apply(this,t):function(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e.apply(n,[].concat(t,o))}})(C),E={config:function(e){var n;return e||j("configIsRequired"),n=e,{}.toString.call(n).includes("Object")||j("configType"),e.urls?(console.warn(C.deprecation),{paths:{vs:e.urls.monacoBase}}):e}};function S(e,n){return Object.keys(n).forEach((function(r){n[r]instanceof Object&&e[r]&&Object.assign(n[r],S(e[r],n[r]))})),s(s({},e),n)}var k={type:"cancelation",msg:"operation is manually canceled"};function P(e){var n=!1,r=new Promise((function(r,t){e.then((function(e){return n?t(k):r(e)})),e.catch(t)}));return r.cancel=function(){return n=!0},r}var R,N,x=M.create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.25.2/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}),I=(N=2,function(e){if(Array.isArray(e))return e}(R=x)||function(e,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],t=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(t=(a=u.next()).done)&&(r.push(a.value),!n||r.length!==n);t=!0);}catch(e){o=!0,i=e}finally{try{t||null==u.return||u.return()}finally{if(o)throw i}}return r}}(R,N)||function(e,n){if(e){if("string"==typeof e)return c(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,n):void 0}}(R,N)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),q=I[0],_=I[1];function L(e){return document.body.appendChild(e)}function V(e){var n,r,t=q((function(e){return{config:e.config,reject:e.reject}})),o=(n="".concat(t.config.paths.vs,"/loader.js"),r=document.createElement("script"),n&&(r.src=n),r);return o.onload=function(){return e()},o.onerror=t.reject,o}function D(){var e=q((function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}})),n=window.require;n.config(e.config),n(["vs/editor/editor.main"],(function(n){A(n),e.resolve(n)}),(function(n){e.reject(n)}))}function A(e){q().monaco||_({monaco:e})}var K=new Promise((function(e,n){return _({resolve:e,reject:n})})),z={config:function(e){_((function(n){return{config:S(n.config,E.config(e))}}))},init:function(){if(!q((function(e){return{isInitialized:e.isInitialized}})).isInitialized){if(window.monaco&&window.monaco.editor)return A(window.monaco),P(Promise.resolve(window.monaco));!function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(e){return n.reduceRight((function(e,n){return n(e)}),e)}}(L,V)(D),_({isInitialized:!0})}return P(K)},__getMonacoInstance:function(){return q((function(e){return e.monaco}))}};const B={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function U({content:e}){return i.default.createElement("div",{style:B},e)}const F={display:"flex",position:"relative",textAlign:"initial"},$={width:"100%"},W={display:"none"};function Y({width:e,height:n,isEditorReady:r,loading:t,_ref:o,className:a,wrapperClassName:u}){return i.default.createElement("section",{style:{...F,width:e,height:n},className:u},!r&&i.default.createElement(U,{content:t}),i.default.createElement("div",{ref:o,style:{...$,...!r&&W},className:a}))}Y.propTypes={width:e.propTypes.oneOfType([e.propTypes.number,e.propTypes.string]).isRequired,height:e.propTypes.oneOfType([e.propTypes.number,e.propTypes.string]).isRequired,loading:e.propTypes.oneOfType([e.propTypes.element,e.propTypes.string]).isRequired,isEditorReady:e.propTypes.bool.isRequired,className:e.propTypes.string,wrapperClassName:e.propTypes.string};var G=n.memo(Y);function H(e){n.useEffect(e,[])}function J(e,r,t=!0){const o=n.useRef(!0);n.useEffect(o.current||!t?()=>{o.current=!1}:e,r)}function Q(){}function X(e,n,r,t){return function(e,n){return e.editor.getModel(Z(e,n))}(e,t)||function(e,n,r,t){return e.editor.createModel(n,r,t&&Z(e,t))}(e,n,r,t)}function Z(e,n){return e.Uri.parse(n)}function ee({original:e,modified:r,language:t,originalLanguage:o,modifiedLanguage:a,originalModelPath:u,modifiedModelPath:s,keepCurrentOriginalModel:c,keepCurrentModifiedModel:l,theme:p,loading:d,options:f,height:g,width:h,className:m,wrapperClassName:y,beforeMount:v,onMount:b}){const[T,w]=n.useState(!1),[M,O]=n.useState(!0),C=n.useRef(null),j=n.useRef(null),E=n.useRef(null),S=n.useRef(b),k=n.useRef(v);H((()=>{const e=z.init();return e.then((e=>(j.current=e)&&O(!1))).catch((e=>"cancelation"!==(null==e?void 0:e.type)&&console.error("Monaco initialization: error:",e))),()=>C.current?function(){const e=C.current.getModel();var n,r;c||null===(n=e.original)||void 0===n||n.dispose();l||null===(r=e.modified)||void 0===r||r.dispose();C.current.dispose()}():e.cancel()})),J((()=>{const e=C.current.getModifiedEditor();e.getOption(j.current.editor.EditorOption.readOnly)?e.setValue(r):r!==e.getValue()&&(e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),e.pushUndoStop())}),[r],T),J((()=>{C.current.getModel().original.setValue(e)}),[e],T),J((()=>{const{original:e,modified:n}=C.current.getModel();j.current.editor.setModelLanguage(e,o||t),j.current.editor.setModelLanguage(n,a||t)}),[t,o,a],T),J((()=>{j.current.editor.setTheme(p)}),[p],T),J((()=>{C.current.updateOptions(f)}),[f],T);const P=n.useCallback((()=>{k.current(j.current);const n=j.current.editor.createModel(e,o||t,u&&j.current.Uri.parse(u)),i=j.current.editor.createModel(r,a||t,s&&j.current.Uri.parse(s));C.current.setModel({original:n,modified:i})}),[t,r,a,e,o,u,s]),R=n.useCallback((()=>{C.current=j.current.editor.createDiffEditor(E.current,{automaticLayout:!0,...f}),P(),j.current.editor.setTheme(p),w(!0)}),[f,p,P]);return n.useEffect((()=>{T&&S.current(C.current,j.current)}),[T]),n.useEffect((()=>{!M&&!T&&R()}),[M,T,R]),i.default.createElement(G,{width:h,height:g,isEditorReady:T,loading:d,_ref:E,className:m,wrapperClassName:y})}ee.propTypes={original:e.propTypes.string,modified:e.propTypes.string,language:e.propTypes.string,originalLanguage:e.propTypes.string,modifiedLanguage:e.propTypes.string,originalModelPath:e.propTypes.string,modifiedModelPath:e.propTypes.string,keepCurrentOriginalModel:e.propTypes.bool,keepCurrentModifiedModel:e.propTypes.bool,theme:e.propTypes.string,loading:e.propTypes.oneOfType([e.propTypes.element,e.propTypes.string]),options:e.propTypes.object,width:e.propTypes.oneOfType([e.propTypes.number,e.propTypes.string]),height:e.propTypes.oneOfType([e.propTypes.number,e.propTypes.string]),className:e.propTypes.string,wrapperClassName:e.propTypes.string,beforeMount:e.propTypes.func,onMount:e.propTypes.func},ee.defaultProps={theme:"light",loading:"Loading...",options:{},keepCurrentOriginalModel:!1,keepCurrentModifiedModel:!1,width:"100%",height:"100%",beforeMount:Q,onMount:Q};const ne=new Map;function re({defaultValue:e,defaultLanguage:r,defaultPath:t,value:o,language:a,path:u,theme:s,line:c,loading:l,options:p,overrideServices:d,saveViewState:f,keepCurrentModel:g,width:h,height:m,className:y,wrapperClassName:v,beforeMount:b,onMount:T,onChange:w,onValidate:M}){const[O,C]=n.useState(!1),[j,E]=n.useState(!0),S=n.useRef(null),k=n.useRef(null),P=n.useRef(null),R=n.useRef(T),N=n.useRef(b),x=n.useRef(null),I=n.useRef(o),q=function(e){const r=n.useRef();return n.useEffect((()=>{r.current=e}),[e]),r.current}(u);H((()=>{const e=z.init();return e.then((e=>(S.current=e)&&E(!1))).catch((e=>"cancelation"!==(null==e?void 0:e.type)&&console.error("Monaco initialization: error:",e))),()=>k.current?function(){var e,n;null===(e=x.current)||void 0===e||e.dispose(),g?f&&ne.set(u,k.current.saveViewState()):null===(n=k.current.getModel())||void 0===n||n.dispose();k.current.dispose()}():e.cancel()})),J((()=>{const n=X(S.current,e||o,r||a,u);n!==k.current.getModel()&&(f&&ne.set(q,k.current.saveViewState()),k.current.setModel(n),f&&k.current.restoreViewState(ne.get(u)))}),[u],O),J((()=>{k.current.updateOptions(p)}),[p],O),J((()=>{k.current.getOption(S.current.editor.EditorOption.readOnly)?k.current.setValue(o):o!==k.current.getValue()&&(k.current.executeEdits("",[{range:k.current.getModel().getFullModelRange(),text:o,forceMoveMarkers:!0}]),k.current.pushUndoStop())}),[o],O),J((()=>{S.current.editor.setModelLanguage(k.current.getModel(),a)}),[a],O),J((()=>{void 0!==c&&k.current.revealLine(c)}),[c],O),J((()=>{S.current.editor.setTheme(s)}),[s],O);const _=n.useCallback((()=>{N.current(S.current);const n=u||t,i=X(S.current,o||e,r||a,n);k.current=S.current.editor.create(P.current,{model:i,automaticLayout:!0,...p},d),f&&k.current.restoreViewState(ne.get(n)),S.current.editor.setTheme(s),C(!0)}),[e,r,t,o,a,u,p,d,f,s]);return n.useEffect((()=>{O&&R.current(k.current,S.current)}),[O]),n.useEffect((()=>{!j&&!O&&_()}),[j,O,_]),I.current=o,n.useEffect((()=>{var e,n;O&&w&&(null===(e=x.current)||void 0===e||e.dispose(),x.current=null===(n=k.current)||void 0===n?void 0:n.onDidChangeModelContent((e=>{const n=k.current.getValue();I.current!==n&&w(n,e)})))}),[O,w]),n.useEffect((()=>{if(O){const e=S.current.editor.onDidChangeMarkers((e=>{var n;const r=null===(n=k.current.getModel())||void 0===n?void 0:n.uri;if(r){if(e.find((e=>e.path===r.path))){const e=S.current.editor.getModelMarkers({resource:r});null==M||M(e)}}}));return()=>{null==e||e.dispose()}}}),[O,M]),i.default.createElement(G,{width:h,height:m,isEditorReady:O,loading:l,_ref:P,className:y,wrapperClassName:v})}re.propTypes={defaultValue:e.propTypes.string,defaultPath:e.propTypes.string,defaultLanguage:e.propTypes.string,value:e.propTypes.string,language:e.propTypes.string,path:e.propTypes.string,theme:e.propTypes.string,line:e.propTypes.number,loading:e.propTypes.oneOfType([e.propTypes.element,e.propTypes.string]),options:e.propTypes.object,overrideServices:e.propTypes.object,saveViewState:e.propTypes.bool,keepCurrentModel:e.propTypes.bool,width:e.propTypes.oneOfType([e.propTypes.number,e.propTypes.string]),height:e.propTypes.oneOfType([e.propTypes.number,e.propTypes.string]),className:e.propTypes.string,wrapperClassName:e.propTypes.string,beforeMount:e.propTypes.func,onMount:e.propTypes.func,onChange:e.propTypes.func,onValidate:e.propTypes.func},re.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",beforeMount:Q,onMount:Q,onValidate:Q};var te=n.memo(re);function oe(n,r,t,o){var i,a,u,s=[];try{for(var c=e.__values(t),l=c.next();!l.done;l=c.next()){var p=l.value;r&&!p.label.startsWith(r)||s.push(e.__assign(e.__assign({},p),{kind:ie(n,p.kind),range:o,insertText:null!==(u=p.insertText)&&void 0!==u?u:p.label}))}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}return s}function ie(n,r){switch(r){case e.CodeEditorSuggestionItemKind.Method:return n.languages.CompletionItemKind.Method;case e.CodeEditorSuggestionItemKind.Field:return n.languages.CompletionItemKind.Field;case e.CodeEditorSuggestionItemKind.Property:return n.languages.CompletionItemKind.Property;case e.CodeEditorSuggestionItemKind.Constant:return n.languages.CompletionItemKind.Constant;case e.CodeEditorSuggestionItemKind.Text:return n.languages.CompletionItemKind.Text}return n.languages.CompletionItemKind.Text}function ae(e,n,r){if(n&&r)return e.languages.registerCompletionItemProvider(n,{triggerCharacters:["$"],provideCompletionItems:function(n,t,o){var i={startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:t.column,endColumn:t.column};if("$"===o.triggerCharacter)return i.startColumn=t.column-1,{suggestions:oe(e,"$",r(),i)};var a=function(e){for(var n=e.length-1;n>0;n--){var r=e.charAt(n);if("$"===r)return{index:n,prefix:e.substring(n)};if(" "===r||"\t"===r||'"'===r||"'"===r)return{index:n+1,prefix:e.substring(n+1)}}return{index:0,prefix:e}}(n.getValueInRange({startLineNumber:t.lineNumber,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column})),u=a.index,s=a.prefix;i.startColumn=u+1;var c=oe(e,s,r(),i);return c.length?{suggestions:c}:void 0}})}var ue=!1;var se,ce=function(n){function o(e){var t,o=n.call(this,e)||this;return o.loadCustomLanguage=function(){var e=o.props.language,n=r.monacoLanguageRegistry.getIfExists(e);return n?n.init():Promise.resolve()},o.getEditorValue=function(){return""},o.onBlur=function(){var e=o.props.onBlur;e&&e(o.getEditorValue())},o.onSave=function(){var e=o.props.onSave;e&&e(o.getEditorValue())},o.handleBeforeMount=function(e){o.monaco=e;var n=o.props,r=n.language,t=n.theme,i=n.getSuggestions,a=n.onBeforeEditorMount;!function(e,n){var r={"editor.background":n.components.input.background,"minimap.background":n.colors.background.secondary};e.editor.defineTheme("grafana-dark",{base:"vs-dark",inherit:!0,colors:r,rules:[]}),e.editor.defineTheme("grafana-light",{base:"vs",inherit:!0,colors:r,rules:[]})}(e,t),i&&(o.completionCancel=ae(e,r,i)),null==a||a(e)},o.handleOnMount=function(e,n){var r=o.props.onEditorDidMount;o.getEditorValue=function(){return e.getValue()},e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.KEY_S,o.onSave);var t=o.loadCustomLanguage();r&&t.then((function(){return r(e,n)}))},ue||(z.config({paths:{vs:(null!==(t=window.__grafana_public_path__)&&void 0!==t?t:"public/")+"lib/monaco/min/vs"}}),ue=!0),o}return e.__extends(o,n),o.prototype.componentWillUnmount=function(){this.completionCancel&&this.completionCancel.dispose()},o.prototype.componentDidUpdate=function(e){var n=this.props,r=n.getSuggestions,t=n.language;if(t!==e.language){if(this.completionCancel&&this.completionCancel.dispose(),!this.monaco)return void console.warn("Monaco instance not loaded yet");r&&(this.completionCancel=ae(this.monaco,t,r)),this.loadCustomLanguage()}},o.prototype.render=function(){var n,r=this.props,o=r.theme,a=r.language,u=r.width,s=r.height,c=r.showMiniMap,l=r.showLineNumbers,p=r.readOnly,d=r.monacoOptions,f=null!==(n=this.props.value)&&void 0!==n?n:"",g=f.length>100,h=pe(o),m={wordWrap:"off",tabSize:2,codeLens:!1,contextmenu:!1,minimap:{enabled:g&&c,renderCharacters:!1},readOnly:p,lineNumbersMinChars:4,lineDecorationsWidth:1*o.spacing.gridSize,overviewRulerBorder:!1,automaticLayout:!0,padding:{top:.5*o.spacing.gridSize,bottom:.5*o.spacing.gridSize}};return l||(m.glyphMargin=!1,m.folding=!1,m.lineNumbers="off",m.lineNumbersMinChars=0),i.default.createElement("div",{className:h.container,onBlur:this.onBlur,"aria-label":t.selectors.components.CodeEditor.container},i.default.createElement(te,{width:u,height:s,language:a,theme:o.isDark?"grafana-dark":"grafana-light",value:f,options:e.__assign(e.__assign({},m),null!=d?d:{}),beforeMount:this.handleBeforeMount,onMount:this.handleOnMount}))},o}(i.default.PureComponent),le=e.withTheme2(ce),pe=function(n){return{container:e.css(se||(se=e.__makeTemplateObject(["\n      border-radius: ",";\n      border: 1px solid ",";\n    "],["\n      border-radius: ",";\n      border: 1px solid ",";\n    "])),n.shape.borderRadius(),n.components.input.borderColor)}};exports.default=le;
//# sourceMappingURL=CodeEditor.production.js.map
